<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Echecs AlphaBeta - Neura'TN</title>
    <link rel="stylesheet" href="/static/chess/style.css">
</head>
<body>
    <header>
        <div class="header-left">
            <a href="/" class="back-link">&larr; Accueil</a>
            <img src="/static/logo.png" alt="Neura'TN" class="header-logo">
        </div>
        <h1>Echecs AlphaBeta</h1>
        <div class="controls">
            <button id="btn-new">Nouvelle partie</button>
            <button id="btn-undo">Annuler</button>
            <div class="depth-group">
                <label>Profondeur :</label>
                <button class="depth-btn" data-depth="2">2</button>
                <button class="depth-btn active" data-depth="3">3</button>
                <button class="depth-btn" data-depth="4">4</button>
            </div>
        </div>
    </header>

    <main>
        <section class="board-panel">
            <h2>Echiquier</h2>
            <div class="board-outer">
                <div class="rank-labels">
                    <span>8</span><span>7</span><span>6</span><span>5</span>
                    <span>4</span><span>3</span><span>2</span><span>1</span>
                </div>
                <div class="board-col">
                    <div class="board-wrapper">
                        <div id="chess-board" class="chess-board"></div>
                        <div id="thinking-overlay" class="thinking-overlay" style="display:none;">
                            <span class="thinking-text">L'IA reflechit...</span>
                        </div>
                    </div>
                    <div class="file-labels">
                        <span>a</span><span>b</span><span>c</span><span>d</span>
                        <span>e</span><span>f</span><span>g</span><span>h</span>
                    </div>
                </div>
            </div>
            <div id="game-status" class="game-status"></div>
            <div id="move-history" class="move-history"></div>
        </section>

        <section class="editor-panel">
            <div class="eval-editor-wrapper">
                <h2>Fonction d'evaluation</h2>
                <div class="preset-group">
                    <label>Exemples :</label>
                    <button class="preset-btn" data-preset="material">Materiel</button>
                    <button class="preset-btn" data-preset="opening">Ouverture</button>
                    <button class="preset-btn" data-preset="middlegame">Milieu</button>
                    <button class="preset-btn" data-preset="endgame">Fin de partie</button>
                </div>
                <textarea id="eval-editor" spellcheck="false"></textarea>
                <div id="doc-panel" class="doc-panel" style="display:none;">
                    <div class="doc-content">
                    <h3>Objet board (chess.Board)</h3>
                    <dl>
                        <dt>board.piece_map()</dt>
                        <dd>Dict {case: piece} de toutes les pieces sur l'echiquier.</dd>
                        <dt>board.piece_at(square)</dt>
                        <dd>Retourne la piece a la case donnee, ou None.</dd>
                        <dt>board.piece_type_at(square)</dt>
                        <dd>Retourne le type de piece (int) a la case, ou None.</dd>
                        <dt>board.color_at(square)</dt>
                        <dd>Retourne la couleur (True=blanc, False=noir) a la case, ou None.</dd>
                        <dt>board.is_checkmate()</dt>
                        <dd>True si la position est un echec et mat.</dd>
                        <dt>board.is_check()</dt>
                        <dd>True si le roi du joueur actif est en echec.</dd>
                        <dt>board.is_stalemate()</dt>
                        <dd>True si la position est un pat.</dd>
                        <dt>board.is_insufficient_material()</dt>
                        <dd>True si le materiel est insuffisant pour mater.</dd>
                        <dt>board.can_claim_draw()</dt>
                        <dd>True si une nulle peut etre reclamee (repetition, 50 coups).</dd>
                        <dt>board.legal_moves</dt>
                        <dd>Generateur des coups legaux. Utiliser: len(list(board.legal_moves))</dd>
                        <dt>board.turn</dt>
                        <dd>True si c'est aux blancs de jouer, False pour les noirs.</dd>
                        <dt>board.fullmove_number</dt>
                        <dd>Numero du coup actuel (commence a 1).</dd>
                        <dt>board.has_kingside_castling_rights(color)</dt>
                        <dd>True si le roque cote roi est disponible.</dd>
                        <dt>board.has_queenside_castling_rights(color)</dt>
                        <dd>True si le roque cote dame est disponible.</dd>
                        <dt>board.pieces(piece_type, color)</dt>
                        <dd>Ensemble des cases contenant ce type de piece de cette couleur.</dd>
                    </dl>

                    <h3>Types de pieces</h3>
                    <dl>
                        <dt>chess.PAWN = 1</dt><dd>Pion</dd>
                        <dt>chess.KNIGHT = 2</dt><dd>Cavalier</dd>
                        <dt>chess.BISHOP = 3</dt><dd>Fou</dd>
                        <dt>chess.ROOK = 4</dt><dd>Tour</dd>
                        <dt>chess.QUEEN = 5</dt><dd>Dame</dd>
                        <dt>chess.KING = 6</dt><dd>Roi</dd>
                    </dl>

                    <h3>Couleurs</h3>
                    <dl>
                        <dt>chess.WHITE = True</dt><dd>Blancs</dd>
                        <dt>chess.BLACK = False</dt><dd>Noirs</dd>
                    </dl>

                    <h3>Utilitaires de cases</h3>
                    <dl>
                        <dt>chess.square_rank(square)</dt>
                        <dd>Rang de la case (0-7, 0 = rangee 1).</dd>
                        <dt>chess.square_file(square)</dt>
                        <dd>Colonne de la case (0-7, 0 = colonne a).</dd>
                        <dt>chess.square(file, rank)</dt>
                        <dd>Cree une case a partir de la colonne et du rang.</dd>
                        <dt>chess.E4, chess.D4, ...</dt>
                        <dd>Constantes pour les cases (A1=0, B1=1, ..., H8=63).</dd>
                    </dl>

                    <h3>Objet piece</h3>
                    <dl>
                        <dt>piece.piece_type</dt>
                        <dd>Type de la piece (1-6, voir ci-dessus).</dd>
                        <dt>piece.color</dt>
                        <dd>Couleur (True=blanc, False=noir).</dd>
                        <dt>piece.symbol()</dt>
                        <dd>Symbole FEN: 'P','N','B','R','Q','K' (blanc), 'p','n','b','r','q','k' (noir).</dd>
                    </dl>
                    </div>
                </div>
                <div class="editor-actions">
                    <button id="btn-validate">Valider la fonction</button>
                    <button id="btn-save">Sauvegarder</button>
                    <button id="btn-doc">Documentation</button>
                    <span id="eval-status" class="eval-status"></span>
                </div>
            </div>

            <div id="search-stats" class="stats" style="display:none;">
                <h2>Statistiques de recherche</h2>
                <div class="stat-row"><span class="stat-label">Noeuds explores</span><span id="stat-nodes" class="stat-value">0</span></div>
                <div class="stat-row"><span class="stat-label">Branches coupees</span><span id="stat-pruned" class="stat-value">0</span></div>
                <div class="stat-row"><span class="stat-label">Temps de recherche</span><span id="stat-time" class="stat-value">0 ms</span></div>
                <div class="stat-row"><span class="stat-label">Profondeur</span><span id="stat-depth" class="stat-value">3</span></div>
            </div>

            <div class="info-text">
                <h2>Comment ca marche</h2>
                <p>L'IA utilise l'algorithme <strong>Alpha-Beta</strong> pour explorer l'arbre des coups possibles et choisir le meilleur coup.</p>
                <p><strong>Votre role :</strong> ecrivez la fonction <code>evaluate(board)</code> en Python qui evalue une position. Un score positif favorise les blancs, negatif les noirs.</p>
                <p><strong>Alpha-Beta :</strong> amelioration du Minimax qui "coupe" les branches inutiles de l'arbre de recherche, reduisant le nombre de positions a evaluer.</p>
                <p><strong>Arbre :</strong> en dessous, visualisez l'arbre de recherche complet avec les valeurs alpha/beta et les coupures.</p>
            </div>
        </section>
    </main>

    <section class="tree-section">
        <div class="tree-header">
            <h2>Arbre de recherche AlphaBeta</h2>
            <button id="btn-toggle-tree">Replier</button>
            <div class="tree-legend">
                <span class="tree-legend-item"><span class="legend-swatch max-node"></span>MAX (blancs)</span>
                <span class="tree-legend-item"><span class="legend-swatch min-node"></span>MIN (noirs)</span>
                <span class="tree-legend-item"><span class="legend-swatch best-path"></span>Meilleur chemin</span>
                <span class="tree-legend-item"><span class="legend-swatch pruned"></span>Coupe</span>
            </div>
        </div>
        <div id="tree-container" class="tree-container">
            <p class="tree-empty">Jouez un coup pour voir l'arbre de recherche.</p>
        </div>
    </section>

    <script src="/static/chess/app.js"></script>
</body>
</html>
